#!/usr/bin/env bash
# USAGE: git check "<LABEL>"
# Examples for <LABEL>: TODO FIXME BUG NOTE XXX HACK FEATURE IDEA WISH

LABEL="$1"
ROOT=$(git root)
SOURCE_PATTERN='HEAD:\([^:]*\):\([0-9]*\):.*'"$LABEL"': \(.*\)'
TARGET_PATTERN='- [`#L\2`](\1#L\2) \3'

echo "## $LABEL's"
echo ""

for file in $(git ls-files)
do
    items=$(git grep -n -E "$LABEL: " "HEAD" -- "$ROOT/$file")
    [ -z "$items" ] && continue
    echo "### [$file]($file)"; echo ""
    printf "$items" | sed 's/'"$SOURCE_PATTERN"'/'"$TARGET_PATTERN"'/'
    echo ""
    echo ""
done

